<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Campus AR Navigator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- A-Frame + AR.js -->
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>


<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

/* UI PANEL */
#ui {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.85);
    padding: 15px;
    border-radius: 12px;
    color: white;
    width: 90%;
    max-width: 400px;
    z-index: 10;
}

select, button {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
}

button {
    background: #00ff88;
    font-weight: bold;
    cursor: pointer;
}

#status {
    text-align: center;
    margin-bottom: 8px;
    font-size: 14px;
}
</style>
</head>

<body>

<!-- AR SCENE -->
<a-scene embedded arjs>


<a-marker preset = "custom" type = "barcode" value = "1">
  <a-text
    value="You're on Floor 1\nSelect your destination"
    position="0 0 -1.2"
    align="center"
    color="#00ff88"
    width="4">
  </a-text>
<a-marker>
  <a-entity
  camera
  look-controls
  fov="75"
  near="0.1"
  far="1000"
  position="0 0 0">
  </a-entity>
</a-scene>


<!-- UI -->
<div id="ui">
    <div id="status">Waiting for destination‚Ä¶</div>

    <select id="roomSelect">
        <option value="">Select destination</option>
    </select>

    <button onclick="startNavigation()">Start Navigation</button>
</div>

<script>
// =======================
// DATA
// =======================
const rooms = {
    1: ["101","102","103","104","105"],
    2: ["201","202","203","204","205"],
    3: ["301","302","303","304","305"],
    4: ["401","402","403","404","405"],
    5: ["501","502","503","504","505"]
};

const state = {
    currentFloor: null,
    destination: null
};

// =======================
// INIT FROM QR (URL)
// =======================
window.addEventListener("load", () => {
    const params = new URLSearchParams(window.location.search);
    const floor = params.get("floor");

    if (floor && rooms[floor]) {
        state.currentFloor = floor;
        showStartText(floor);
        populateRooms();
    } else {
        document.getElementById("status").textContent =
            "‚ùå Invalid or missing floor QR";
    }
});

// =======================
// UI FUNCTIONS
// =======================
function populateRooms() {
    const select = document.getElementById("roomSelect");

    for (const floor in rooms) {
        const group = document.createElement("optgroup");
        group.label = `Floor ${floor}`;

        rooms[floor].forEach(room => {
            const option = document.createElement("option");
            option.value = `${floor}-${room}`;
            option.textContent = `Room ${room}`;
            group.appendChild(option);
        });

        select.appendChild(group);
    }
}

function showStartText(floor) {
    const text = document.getElementById("startText");
    text.setAttribute(
        "value",
        `üìç You are on Floor ${floor}\nStart here`
    );
    text.setAttribute("visible", true);
}

function startNavigation() {
    const value = document.getElementById("roomSelect").value;
    if (!value) return alert("Select a destination");

    const [destFloor, room] = value.split("-");
    state.destination = { floor: destFloor, room };

    document.getElementById("status").textContent =
        `Navigating to Room ${room} (Floor ${destFloor})`;

    document.getElementById("navArrow").setAttribute("visible", true);
}
</script>

</body>
</html>
