<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Campus AR Navigator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- A-Frame + AR.js -->
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

#ui {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.85);
  padding: 15px;
  border-radius: 12px;
  color: white;
  width: 90%;
  max-width: 400px;
  z-index: 10;
}

select, button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}

button {
  background: #00ff88;
  font-weight: bold;
  cursor: pointer;
}

button:disabled {
  background: #666;
  cursor: not-allowed;
}

#status {
  text-align: center;
  margin-bottom: 8px;
  font-size: 14px;
}

#debug {
  font-size: 12px;
  color: #ffaa00;
  margin-top: 10px;
  max-height: 100px;
  overflow-y: auto;
}

.tab {
  display: inline-block;
  padding: 8px 16px;
  margin: 5px;
  background: #333;
  border-radius: 6px;
  cursor: pointer;
}

.tab.active {
  background: #00ff88;
  color: black;
}

#patternMode, #builtinMode {
  display: none;
}

#patternMode.active, #builtinMode.active {
  display: block;
}

a {
  color: #00ff88;
}
</style>
</head>

<body>

<!-- AR SCENE -->
<a-scene
  embedded
  arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
  vr-mode-ui="enabled: false">

  <a-entity camera></a-entity>

  <!-- Built-in marker test -->
  <a-marker preset="hiro" id="testMarker">
    <a-cone
      position="0 0.5 0"
      rotation="-90 0 0"
      height="0.5"
      radius-bottom="0.2"
      color="#00ff88">
    </a-cone>
    <a-text
      value="Test Marker Works!"
      color="#ffff00"
      align="center"
      position="0 1 0"
      scale="0.5 0.5 0.5">
    </a-text>
  </a-marker>

</a-scene>

<!-- UI -->
<div id="ui">
  <div id="status">Choose marker type:</div>
  
  <div>
    <span class="tab active" onclick="switchTab('builtin')">Built-in Markers</span>
    <span class="tab" onclick="switchTab('pattern')">Custom Patterns</span>
  </div>

  <!-- BUILT-IN MODE -->
  <div id="builtinMode" class="active">
    <select id="builtinSelect">
      <option value="hiro">HIRO Marker ‚Üí Room 101</option>
      <option value="kanji">KANJI Marker ‚Üí Room 102</option>
    </select>
    <button onclick="startBuiltinNav()">Start Navigation (Built-in)</button>
    <button onclick="window.open('https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png', '_blank')">üì• Get HIRO Marker</button>
    <button onclick="window.open('https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/kanji.png', '_blank')">üì• Get KANJI Marker</button>
  </div>

  <!-- PATTERN MODE -->
  <div id="patternMode">
    <select id="roomSelect"></select>
    <button onclick="startPatternNav()">Start Navigation (Custom)</button>
    <div style="font-size: 12px; margin-top: 8px; color: #ffaa00;">
      ‚ö†Ô∏è Requires .patt files in /patterns/ folder
    </div>
  </div>

  <div id="debug">Ready. Camera initializing...</div>
</div>

<script>
// -------------------- ROOMS --------------------
const rooms = {
  0: ["TEST"],  // Test room using HIRO
  1: ["101","102","103"],
  2: ["201","202","203"]
};

// -------------------- ROUTES (CUSTOM PATTERNS) --------------------
const routes = {
  "1-101": [
    { id: "start1", patt: "patterns/floor1.patt", text: "üìç Start Floor 1" },
    { id: "hall1", patt: "patterns/hallway1.patt", text: "‚û° Go straight" },
    { id: "turn1", patt: "patterns/turnleft.patt", text: "‚Ü© Turn left" },
    { id: "room101", patt: "patterns/room101.patt", text: "‚úÖ Room 101!" }
  ],
  "1-102": [
    { id: "start1b", patt: "patterns/floor1.patt", text: "üìç Start Floor 1" },
    { id: "hall2", patt: "patterns/hallway2.patt", text: "‚û° Go straight" },
    { id: "room102", patt: "patterns/room102.patt", text: "‚úÖ Room 102!" }
  ]
};

// -------------------- BUILT-IN ROUTES --------------------
const builtinRoutes = {
  "hiro": [
    { preset: "hiro", text: "üìç Start at entrance", next: "‚û° Head to hallway" },
    { preset: "hiro", text: "‚û° Continue straight", next: "‚Ü© Turn at corner" },
    { preset: "hiro", text: "‚úÖ Room 101 reached!" }
  ],
  "kanji": [
    { preset: "kanji", text: "üìç
