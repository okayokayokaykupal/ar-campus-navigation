<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Hello WebXR!</title>

  <!-- three.js r128 (compatible with AR.js) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <!-- AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/three.js/build/ar-threex.js"></script>
</head>
<body style="margin:0; overflow:hidden;">

<script>
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
scene.add(camera);

const renderer = new THREE.WebGLRenderer({
  antialias: true, 
  alpha: true
});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

var ArToolkitSource = new THREEx.ArToolkitSource({
  sourceType: "webcam"
});

ArToolkitSource.init(function(){
  setTimeout(function(){
    ArToolkitSource.onResizeElement();
    ArToolkitSource.copyElementSizeTo(renderer.domElement);
  }, 2000);
});

var ArToolkitContext = new THREEx.ArToolkitContext({
  cameraParametersUrl: 'https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/data/data/camera_para.dat',
  detectionMode: 'mono'
});

ArToolkitContext.init(function(){
  camera.projectionMatrix.copy(ArToolkitContext.getProjectionMatrix());
});

var ArMarkerControls = new THREEx.ArMarkerControls(ArToolkitContext, camera, {
  type: 'pattern',
  patternUrl: 'patterns/hallway1.patt',  // Replace with your pattern file path
  changeMatrixMode: 'cameraTransformMatrix'
});

scene.visible = false;

const geometry = new THREE.BoxGeometry(1, 1, 1);
const material = new THREE.MeshNormalMaterial({ 
  transparent: true, 
  opacity: 0.5, 
  side: THREE.DoubleSide
});
const cube = new THREE.Mesh(geometry, material);
cube.position.y = geometry.parameters.height / 2;
scene.add(cube);

function animate() {
  requestAnimationFrame(animate);
  
  if (ArToolkitSource.ready) {
    ArToolkitContext.update(ArToolkitSource.domElement);
    scene.visible = camera.visible;
  }
  
  renderer.render(scene, camera);
}

animate();
</script>

</body>
</html>
